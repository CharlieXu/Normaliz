\documentclass[12pt,a4paper]{scrartcl}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage[latin1]{inputenc}
\usepackage{mathptmx}
\usepackage{amscd}
\usepackage{array}
\usepackage{color}
\usepackage{hyperref}
\usepackage{url}
\usepackage{graphicx}

\usepackage{booktabs}

%\textwidth=15cm \textheight=22cm \topmargin=0.5cm
%\oddsidemargin=0.5cm \evensidemargin=0.5cm

\usepackage[T1]{fontenc}

\usepackage[scaled=0.8]{beramono}

\usepackage{fancyvrb} \RecustomVerbatimEnvironment{Verbatim}{Verbatim} {xleftmargin=15pt}


\newcounter{listi}
\newcommand{\stdli}{ \topsep0ex \partopsep0ex % .5ex plus.25ex minus.125ex%
    \parsep.2ex plus.1ex minus.1ex \itemsep0ex% .5ex plus.25ex minus.125ex%
    \leftmargin2.5em \labelwidth2em \labelsep.5em \rightmargin0em}% \samepage }
\newenvironment{arab}{\begin{list}{\textup{(\arabic{listi})}}%
    {\usecounter{listi}\stdli}}{\end{list}}
\newenvironment{rome}{\begin{list}{\textup{(\roman{listi})}}%
    {\usecounter{listi}\stdli}}{\end{list}}
\newenvironment{latin}{\begin{list}{\textup{(\alph{listi})}}%
    {\usecounter{listi}\stdli}}{\end{list}}
\renewenvironment{itemize}{\begin{list}{{$\bullet$}}{\stdli}}{\end{list}}
\newenvironment{myverb}{\begin{small}}{\end{small}\pagebreak[2]}  %%%%%  \vspace{-0.8\baselineskip}




\let\phi=\varphi

\def\CC{{\mathbb C}}
\def\ZZ{{\mathbb Z}}
\def\QQ{{\mathbb Q}}
\def\RR{{\mathbb R}}
\def\EE{{\mathbb E}}
\def\AA{{\mathbb A}}
\def\PP{{\mathbb P}}
\def\NN{{\mathbb N}}

\def\Ker{\operatorname{Ker}}
\def\Im{\operatorname{Im}}
\DeclareMathOperator{\gp}{gp}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\totdeg}{totdeg}


\def\cG{{\mathcal G}}
\def\cR{{\mathcal R}}

\let\hat=\widehat
\let\tilde=\widetilde
\let\Bar=\overline

\let\iso=\cong

\let\epsilon=\varepsilon
\def\discuss#1{\marginparsep=1em\marginparwidth=60pt
     \marginpar{\tt \footnotesize \raggedright #1}}

\definecolor{darkgray}{gray}{0.00}

\addtokomafont{section}{\color{darkgray}}

\setkomafont{sectionentry}{\large}

\addtokomafont{subsection}{\color{darkgray}}

\addtokomafont{subsubsection}{\normalsize}

\parindent=0pt \parskip=4pt

\setcounter{tocdepth}{3}

\def\Normaliz#1+{\textsf{Normaliz}}
\def\jNormaliz#1+{\textsf{jNormaliz}}
\def\NmzIntegrate#1+{\textsf{NmzIntegrate}}

\def\itemtt[#1]{\item[\ttt{#1}]}

\def\ttt{\texttt}


\begin{document}
\vspace*{2cm}

 \centerline{\Large\bf NmzIntegrate 1.1} \vspace*{1cm}
 %\vspace*{1cm}





\begin{center}Winfried Bruns and Christof
Söger\\[14pt] \tt
wbruns@uos.de\\
csoeger@uos.de
\end{center}
\vspace*{1cm}


%\tableofcontents

%\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  INTRODUCTION  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{The objectives of \NmzIntegrate+}



We assume in the following that the reader is familiar with
\Normaliz+, in particular with its treatment of Ehrhart series
and quasipolynomials. \NmzIntegrate+ requires \Normaliz+ 2.9 or
higher.

\Normaliz+ computes certain data for a monoid $$ M=C\cap L $$
where $C\subset\RR^n$ is a rational, polyhedral and pointed
cone, and $L\subset \ZZ^n$ is a sublattice. These data are
defined by the input to \Normaliz+. \NmzIntegrate+ requires
that $M$ has been endowed with a grading $\deg$ (see the manual
of \Normaliz+).

For such graded monoids \Normaliz+ can compute the volume of
the rational polytope
$$
P=\{x\in \RR_+ M: \deg x=1\},
$$
the Ehrhart series of $P$, and the quasipolynomial representing
the Ehrhart function. (Here $\RR_+M$ is the cone generated by
the elements of $M$; it may be smaller than $C$ if $L$ has rank
$<n$.)

These computations can be understood as integrals of the
constant polynomial $f=1$, namely with respect to the counting
measure defined by $L$ for the Ehrhart function, and with
respect to the (suitably normed) Lebesgue measure for the
volume. \NmzIntegrate+ generalizes these computations to
arbitrary polynomials $f$ in $n$ variables with rational
coefficients. (Mathematically, there is no need to restrict
oneself to rational coefficients for $f$.)

More precisely, set
$$
E(f,k)=\sum_{x\in M, \deg x=k} f(x),
$$
and call $E(f,\_)$ the \emph{generalized Ehrhart function} for
$f$. (With $f=1$ we simply count lattice points.) The
\emph{generalized Ehrhart series} is the ordinary generating
function
$$
E_f(t)=\sum_{k=0}^\infty E(f,k)t^k.
$$
It turns out that $E_f(t)$ is the power series expansion of a
rational function at the origin, and can always be written in
the form
$$
E_f(t)=\frac{Q(t)}{(1-t^\ell)^{\totdeg f+\rank M}},\qquad Q(t)\in\QQ[t],\
\deg Q< \totdeg f+\rank M.
$$
Here $\totdeg f$ is the total degree of the polynomial $f$, and
$\ell$ is the least common  multiple of the degrees of the
extreme integral generators of $M$. See \cite{BS} for an
elementary account and the algorithm used by \NmzIntegrate+.

It follows from the general theory of rational generating
functions that there exists a quasipolynomial $q(k)$ with
rational coefficients and of degree $\le \totdeg f+\rank M-1$ that
evaluates to $E(f,k)$ for all $k\ge 0$. A quasipolynomial is a
``polynomial'' with periodic coefficients: there exists a
\emph{period} $\pi\in\NN$ and true polynomials $q^{j}\in\QQ[X]$,
$j=0,\dots,\pi-1$, such that
$$
q(k)=q^{(j)}(k)\qquad \text{if}\quad k\equiv j\pod \pi.
$$
Each of the polynomials $q^{(j)}$ is given as
$$
q^{(j)}(k)=q^{(j)}_0+q^{(j)}_1X+\dots+q^{(j)}_{\totdeg f+\rank M-1}X^{\totdeg f+\rank M-1}
$$
with constant coefficients in $\QQ$. The period $\pi$ divides $\ell$.

Let $m=\totdeg f$ and $f_m$ be the degree $m$ homogeneous
component of $f$. By letting $k$ go to infinity and
approximating $f_m$ by a step function that is constant on the
meshes of $\frac 1kL$ (with respect to a fixed basis), one sees
$$
q^{(j)}_{\totdeg f+\rank M-1}=\int_P f_m\, d\lambda
$$
where $d\lambda$ is the Lebesgue measure that takes value $1$
on a basic mesh of $L\cap \RR M$ in the hyperplane of degree
$1$ elements in $\RR M$. In particular, the \emph{virtual
leading coefficient} $q^{(j)}_{\totdeg f+\rank M-1}$ is
constant and depends only on $f_m$. If the integral vanishes,
the quasipolynomial $q$ has smaller degree, and the true
leading coefficient need not be constant. Following the
terminology of commutative algebra and algebraic geometry, we
call
$$
(\totdeg f+\rank M-1)!\cdot q_{\totdeg f+\rank M-1}
$$
the \emph{virtual multiplicity} of $M$ and $f$. It is an
integer if $f_m$ has integral coefficients and $P$ is a lattice
polytope. \pagebreak[3]

\NmzIntegrate+ computes
\begin{itemize}
\item[(ES)] the generalized Ehrhart series and its
    quasipolynomial,
\item[(Int)] the Lebesgue integral of $f$ over $P$, or
\item[(LC)] the virtual leading coefficient and the virtual
    multiplicity.
\end{itemize}
The user controls the type of computation by a command line
option. (ES) contains (LC), and (LC) is just the evaluation of
(Int) on the highest homogeneous component of $f$. It is
presently not possible to compute the Ehrhart series and the
integral together if $f$ is not homogeneous.
\bigskip

\emph{Acknowledgement.}\enspace We gratefully acknowledge the
support we received from John Abbott and Anna Bigatti in using
CoCoALib, on which the multivariate polynomial algebra in
\NmzIntegrate+ is based.

\section{Input files}

\NmzIntegrate+ can be used in two ways:
\begin{enumerate}
\item by direct call from the command line,
\item by call from within \Normaliz+ with the appropriate
    options.
\end{enumerate}

If \NmzIntegrate+ misses an input file that should have been
produced by \Normaliz+, it calls \Normaliz+ and makes it
produce the missing file(s).

For mutual calls it is necessary that the executables of
\Normaliz+ and \NmzIntegrate+ reside in the same directory.

\subsection{Basic input files}

The files \verb+<project>.in+ and \verb+<project>.pnm+ must be
provided by the user. \Normaliz+ needs \verb+<project>.in+ in
order to produce the files read by \NmzIntegrate+. The file
\verb+<project>.pnm+ contains the polynomial to be integrated.

\subsection{Auxiliary files produced by \Normaliz+}

One runs \Normaliz+ with the option
\begin{itemize}
\itemtt[-T] (or \ttt{-y}) for (Int) and (LC),
\itemtt[-y] for (ES).
\end{itemize}
(It is allowed to combine \ttt{-T} and \ttt{-y}.) If
\NmzIntegrate+ calls \Normaliz+, then it chooses these options
automatically.

This will produce the files with the following suffixes (in
addition to \verb+<project>.out+ and possibly further output
files determined by the \Normaliz+ options \ttt{-f} and \ttt{-a}):
\begin{itemize}
\itemtt[-T] \ttt{inv}, \ttt{tgn}, \ttt{tri}
\itemtt[-y] \ttt{inv}, \ttt{tgn}, \ttt{dec}.
\end{itemize}
\NmzIntegrate+ reads
\begin{itemize}
\item the grading and the rank from \verb+<project>.inv+,
\item the rays of the triangulation from \verb+<project>.tgn+,
\item the triangulation from \verb+<project>.tri+ (for (Int) and (LC)) and
\item the Stanley decomposition from \verb+<project>.dec+ (for
(ES)).
\end{itemize}
If \verb+<project>.tri+ does not exist for one of the
tasks (Int) or (LC), \NmzIntegrate+ checks for the existence of
\verb+<project>.dec+ and reads the triangulation from it.

\NmzIntegrate+ does itself not read \ttt{<project>.in} nor any
other output file of \Normaliz+.

\subsection{The polynomial}

The polynomial is read from the file \verb+<project>.pnm+. The
input format is defined by the following rules:
\begin{enumerate}
\item The polynomial is a product of \emph{nonzero}
    factors.
\item The factors are separated by the character \ttt{*}.
\item A factor is a sum of terms.
\item A term is a product of a rational number and a
    monomial. The number $1$ can of course be omitted.
\item A monomial is a (possibly empty) product of
    indeterminates \verb+x[<i>]+ or powers
    \verb+x[<i>]^<j>+ of indeterminates where \verb+<i>+
    represents an index between $1$ and $n$ and \verb+<j>+
    represents a positive integer.
\item Spaces, line breaks, and the brackets \ttt{(} and
    \ttt{)} can be used for visual structuring. They have
    no mathematical meaning (so far), and will be removed
    before the computation of the polynomial.
\end{enumerate}

Note that the names of the variables are fixed:
\verb+x[1]+,\dots,\verb+x[<n>]+ where \ttt{<n>} represents the
number $n$.

An example:
\begin{myverb}
\begin{Verbatim}
1/120*(x[1]+x[2]^2)*(-2x[3]x[4])
\end{Verbatim}
\end{myverb}
is a well formed input polynomial, but
\begin{myverb}
\begin{Verbatim}
1/120 * x[1]+x[ 2]^2* -2x[3]  x[4]
\end{Verbatim}
\end{myverb}
represents the same polynomial.

Most likely, the syntax check is not 100\% nonsense proof. Note
that some input errors will cause CoCoA exceptions.

\section{Running NmzIntegrate}

There are three ways to run \NmzIntegrate+:
\begin{enumerate}
\item direct call from the command line
\item call from \Normaliz+ (see Normaliz manual)
\item from \jNormaliz+ via \Normaliz+.
\end{enumerate}

The shortest possible command to start \NmzIntegrate+ is
\begin{center}
\tt nmzIntegrate <project>
\end{center}
This will run the default computation (ES) on the
\verb+<project>+. The full input syntax is
\begin{center}
\tt nmzIntegrate [-cEIL] [-x=<T>] <project>
\end{center}
where \ttt{-c} and \ttt{-x=<T>} have the same meaning as for
\Normaliz+:
\begin{itemize}
\itemtt[-c] activates the verbose mode in which control
    information is written to the terminal,
\itemtt[-x=<T>] limits the number of parallel threads to
    \ttt{<T>}.
\end{itemize}

The remaining options control the type of computation:
\begin{itemize}
\itemtt[-E] activates the computation (ES) (the default
    mode, can be omitted),
\itemtt[-I] activates the computation (Int),
\itemtt[-L] activates the computation (LC).
\end{itemize}
These three options can be accumulated. If at least two options
are set, the computations are carried out according to the
following rules:
\begin{itemize}
\item If \ttt{-E} is present, \ttt{-L} will be suppressed since
its result is contained in that of \ttt{-E}.
\item If \ttt{-I} is present, then it will be suppressed if
    one of \ttt{-E} or \ttt{L} is set and the polynomial is
    homogeneous since \ttt{-L} and \ttt{-I} are identical
    for homogeneous polynomials.
\end{itemize}
If two different computations are carried out, then their
output will appear consecutively in the output file.

The options \verb+-c+ and \verb+-x=<T>+ are passed form
\Normaliz+ to \NmzIntegrate+ and vice versa. \NmzIntegrate+
passes also the option \verb+-e+ to \Normaliz+ as a precaution
against overflow errors. If such an error occurs or it is a
priori clear that 64 bit precision is not sufficient for
\Normaliz+, it must be run beforehand with the option \verb+-B+
(and \verb+-T+ or \verb+-y+). \NmzIntegrate+ itself works
always with infinite precision.

Note that \NmzIntegrate+ may need much more memory than
\Normaliz+, especially with a high number of parallel threads.
This is due to the fact that it may have to cope with very long
polynomials.

\section{The output file}

The output will be written to the file \ttt{<project>.intOut}
(so that it can be clearly distinguished from the \Normaliz+
output file).

\NmzIntegrate+ factors the polynomial, and the factorization is
written to the output file. For the computation (LC) the
polynomial is first replaced by its leading form, and the
output file then contains the factorization of the leading
form.

The output file is self explanatory, but see the \Normaliz+
documentation for the interpretation of the format in which the
generalized Ehrhart series and the quasipolynomial are printed.

Please have a look at the files
\begin{center}
\ttt{rationalES.intOut},\quad \ttt{rationalInt.intOut}\quad and\quad
\ttt{rationalLC.intOut}.
\end{center}
They were all produced from the example file \ttt{rational.in}
in the \Normaliz+ distribution and the file \ttt{rational.pnm},
and \ttt{rational.intOut} was suitably renamed.

The directory \ttt{example} contains further input files suited
for \NmzIntegrate+. Look out for files with the suffix
\ttt{pnm}.


\section{Distribution and installation}

The basic package (source, documentation, examples) for
\NmzIntegrate+ is contained in the basic package of \Normaliz+
that you can download from
\medskip

\centerline{\url{http://www.math.uos.de/normaliz}}\medskip

The installation is described in the \Normaliz+ documentation.

Likewise the executable of \NmzIntegrate+ is contained in the
\Normaliz+ executable package for your system.

Therefore \NmzIntegrate+ does not need a separate installation.

\section{Compilation}\label{Comp}

Before the compilation of \NmzIntegrate+ you must compile
\Normaliz+ 2.9 (or higher) and install CoCoLib 0.9951 \cite{CoC} (not
contained in the \Normaliz+ distribution). \NmzIntegrate+ will
not compile with later versions of CoCoALib or earlier versions
of \Normaliz+.

Important: \textbf{after} the configuration of CoCoALib, but
\textbf{before} its compilation via \ttt{make} you must modify
the file \ttt{configuration/autoconf.mk} in the following way:
add the flag
\begin{center}
   \ttt{-DCoCoA\_THREADSAFE\_HACK}
\end{center}
to the definition of \ttt{CXXFLAGS\_COMMON} (probably near line
24 of \ttt{configuration/autoconf.mk}).

Under Linux or Mac OS navigate to the directory
\ttt{genEhrhart} and run \ttt{make}. You should move the
executable \ttt{nmzIntegrate} to the directory that contains
\ttt{normaliz}.

Depending on the location of CoCoALib, you may have to adjust
the path leading to it in the \ttt{Makefile} in
\ttt{genEhrhart}.

If you should want to compile \NmzIntegrate+ under MS Windows,
please contact the authors.


\section{Copyright and how to cite}

\NmzIntegrate+ 1.1 is free software licensed under the GNU
General Public License, version 3. You can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation, either
version 3 of the License, or (at your option) any later
version.

It is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public
License along with the program. If not, see
http://www.gnu.org/licenses/.

Please refer to \Normaliz+ in any publication for which
\NmzIntegrate+ it has been used:
\begin{center}
W. Bruns, B. Ichim and C. Söger: \Normaliz+. Algorithms for
rational cones and affine monoids. Available from
\url{http://www.math.uos.de/normaliz}.
\end{center}

You can add a reference to \cite{BS} in order to indicate that
\NmzIntegrate+ has been used.

\section{Changes relative to version 1.0}

\begin{enumerate}
\item \NmzIntegrate+ can now be used on objects that do not
    have maximal dimension in their surrounding space.
\item \NmzIntegrate+ calls \Normaliz+ if input files are
    missing.
\item The input syntax for polynomials has been improved:
    white space is neglected.
\item The efficiency has been improved significantly by
    using integral arithmetic internally instead of
    rational arithmetic.
\end{enumerate}

\begin{thebibliography}{15.}

\bibitem{CoC} J. Abbott and A. Bigatti, \emph{CoCoALib}. A GPL
    C++ library for  doing Computations in Commutative Algebra.
    Available from \url{http://cocoa.dima.unige.it/cocoalib/}

\bibitem{BS} W. Bruns and C. Söger, \emph{Generalized Ehrhart
    series and integration in Normaliz}.  \url{arXiv:1211.5178}


\end{thebibliography}


\end{document}
